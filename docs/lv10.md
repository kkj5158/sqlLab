# 📘 SQL 실습 문제집: 레벨 10 - 윈도우 함수 (1~10)

윈도우 함수는 단순 집계가 아닌 "행별 맥락"을 파악할 수 있는 SQL 고급 기능입니다.  
이번 레벨에서는 `RANK`, `DENSE_RANK`, `ROW_NUMBER`, `LAG`, `LEAD`, `NTILE` 등 실무에 쓰이는 함수 위주로 구성했습니다.

---

## 🧱 테이블 구조 및 초기 데이터

### `init.sql`

```sql
CREATE TABLE sales (
    id INT PRIMARY KEY,
    employee_name VARCHAR(100),
    department VARCHAR(100),
    sale_date DATE,
    amount INT
);

INSERT INTO sales (id, employee_name, department, sale_date, amount) VALUES
(1, 'Alice', 'A', '2024-01-01', 500),
(2, 'Bob', 'A', '2024-01-01', 300),
(3, 'Alice', 'A', '2024-01-02', 700),
(4, 'Bob', 'A', '2024-01-02', 400),
(5, 'Charlie', 'B', '2024-01-01', 200),
(6, 'Charlie', 'B', '2024-01-02', 600),
(7, 'Diana', 'B', '2024-01-01', 1000),
(8, 'Diana', 'B', '2024-01-03', 300);
```

---

## 🧪 문제 1~10

### 문제 1  
**설명:** 전체 판매 금액 기준으로 순위를 부여하시오. (`RANK()`)

- **예상 결과:**

| employee_name | amount | rank |
|---------------|--------|------|
| Diana         | 1000   | 1    |
| Alice         | 700    | 2    |
| Charlie       | 600    | 3    |
| Alice         | 500    | 4    |
| Bob           | 400    | 5    |
| Bob           | 300    | 6    |
| Diana         | 300    | 6    |
| Charlie       | 200    | 8    |

---

### 문제 2  
**설명:** 동일 금액도 순위를 건너뛰지 않고 부여하시오. (`DENSE_RANK()`)

- **예상 결과:**

| employee_name | amount | dense_rank |
|---------------|--------|-------------|
| Diana         | 1000   | 1           |
| Alice         | 700    | 2           |
| Charlie       | 600    | 3           |
| Alice         | 500    | 4           |
| Bob           | 400    | 5           |
| Bob           | 300    | 6           |
| Diana         | 300    | 6           |
| Charlie       | 200    | 7           |

---

### 문제 3  
**설명:** 각 부서별로 직원별 판매 건에 대해 `ROW_NUMBER()`를 부여하시오.

- **예상 결과:**  
(`PARTITION BY department ORDER BY sale_date, employee_name`)

| department | employee_name | sale_date  | row_num |
|------------|----------------|------------|----------|
| A          | Alice          | 2024-01-01 | 1        |
| A          | Bob            | 2024-01-01 | 2        |
| A          | Alice          | 2024-01-02 | 3        |
| A          | Bob            | 2024-01-02 | 4        |
| B          | Charlie        | 2024-01-01 | 1        |
| B          | Diana          | 2024-01-01 | 2        |
| B          | Charlie        | 2024-01-02 | 3        |
| B          | Diana          | 2024-01-03 | 4        |

---

### 문제 4  
**설명:** 각 직원별로 판매일 순으로 누적 합계를 구하시오. (`SUM() OVER(PARTITION BY employee_name ORDER BY sale_date)`)

- **예상 결과:**

| employee_name | sale_date  | amount | cumulative_sum |
|---------------|------------|--------|-----------------|
| Alice         | 2024-01-01 | 500    | 500             |
| Alice         | 2024-01-02 | 700    | 1200            |
| Bob           | 2024-01-01 | 300    | 300             |
| Bob           | 2024-01-02 | 400    | 700             |
| Charlie       | 2024-01-01 | 200    | 200             |
| Charlie       | 2024-01-02 | 600    | 800             |
| Diana         | 2024-01-01 | 1000   | 1000            |
| Diana         | 2024-01-03 | 300    | 1300            |

---

### 문제 5  
**설명:** 직원별로 이전 판매 금액과의 차이를 계산하시오. (`LAG()`)

- **예상 결과:**

| employee_name | sale_date  | amount | prev_amount | diff |
|---------------|------------|--------|-------------|------|
| Alice         | 2024-01-01 | 500    | NULL        | NULL |
| Alice         | 2024-01-02 | 700    | 500         | 200  |
| Bob           | 2024-01-01 | 300    | NULL        | NULL |
| Bob           | 2024-01-02 | 400    | 300         | 100  |
| Charlie       | 2024-01-01 | 200    | NULL        | NULL |
| Charlie       | 2024-01-02 | 600    | 200         | 400  |
| Diana         | 2024-01-01 | 1000   | NULL        | NULL |
| Diana         | 2024-01-03 | 300    | 1000        | -700 |

---

### 문제 6  
**설명:** 직원별로 다음 판매 금액을 함께 출력하시오. (`LEAD()`)

- **예상 결과:**

| employee_name | sale_date  | amount | next_amount |
|---------------|------------|--------|-------------|
| Alice         | 2024-01-01 | 500    | 700         |
| Alice         | 2024-01-02 | 700    | NULL        |
| Bob           | 2024-01-01 | 300    | 400         |
| Bob           | 2024-01-02 | 400    | NULL        |
| Charlie       | 2024-01-01 | 200    | 600         |
| Charlie       | 2024-01-02 | 600    | NULL        |
| Diana         | 2024-01-01 | 1000   | 300         |
| Diana         | 2024-01-03 | 300    | NULL        |

---

### 문제 7  
**설명:** 직원별로 일별 판매 순위를 출력하시오. (`RANK()`)

- **예상 결과:**

| employee_name | sale_date  | amount | daily_rank |
|---------------|------------|--------|-------------|
| Alice         | 2024-01-01 | 500    | 1           |
| Bob           | 2024-01-01 | 300    | 2           |
| Alice         | 2024-01-02 | 700    | 1           |
| Bob           | 2024-01-02 | 400    | 2           |
| Charlie       | 2024-01-01 | 200    | 2           |
| Diana         | 2024-01-01 | 1000   | 1           |
| Charlie       | 2024-01-02 | 600    | 1           |
| Diana         | 2024-01-03 | 300    | 1           |

---

### 문제 8  
**설명:** 각 부서 내에서 판매 금액 순위를 구하시오.

- **예상 결과:**

| department | employee_name | amount | rank |
|------------|----------------|--------|------|
| A          | Alice          | 700    | 1    |
| A          | Alice          | 500    | 2    |
| A          | Bob            | 400    | 3    |
| A          | Bob            | 300    | 4    |
| B          | Diana          | 1000   | 1    |
| Charlie    | 600            | 2      |
| Diana      | 300            | 3      |
| Charlie    | 200            | 4      |

---

### 문제 9  
**설명:** 판매 금액 기준으로 전체를 4분위로 나눠 출력하시오. (`NTILE(4)`)

- **예상 결과:**

| employee_name | amount | quartile |
|---------------|--------|-----------|
| Diana         | 1000   | 1         |
| Alice         | 700    | 1         |
| Charlie       | 600    | 2         |
| Alice         | 500    | 2         |
| Bob           | 400    | 3         |
| Bob           | 300    | 3         |
| Diana         | 300    | 4         |
| Charlie       | 200    | 4         |

---

### 문제 10  
**설명:** 각 직원의 첫 번째 판매 기록만 조회하시오. (`ROW_NUMBER()` = 1)

- **예상 결과:**

| employee_name | sale_date  | amount |
|---------------|------------|--------|
| Alice         | 2024-01-01 | 500    |
| Bob           | 2024-01-01 | 300    |
| Charlie       | 2024-01-01 | 200    |
| Diana         | 2024-01-01 | 1000   |

---

다음 11~20에서는  
- 누적 평균  
- FIRST_VALUE / LAST_VALUE  
- PARTITION + RANGE  
- 조건부 윈도우 집계  
- 트렌드 비교 (전월 대비 등)  
로 구성해줄게! 지금 드가자?

# 📘 SQL 실습 문제집: 레벨 10 - 윈도우 함수 (11~20)

이번 파트는 윈도우 함수의 다양한 고급 응용을 다룹니다.  
조건부 누적, 트렌드 계산, 월간 비교, 정렬 기반 비율 등을 SQL로 직접 구현해볼 수 있어요.

> `init.sql`은 이전(1~10)과 동일한 `sales` 테이블을 사용합니다.

---

## 🧪 문제 11~20

### 문제 11  
**설명:** 직원별 누적 평균 금액을 구하시오. (`AVG() OVER(...)`)

- **예상 결과:**

| employee_name | sale_date  | amount | running_avg |
|---------------|------------|--------|--------------|
| Alice         | 2024-01-01 | 500    | 500.0        |
| Alice         | 2024-01-02 | 700    | 600.0        |
| Bob           | 2024-01-01 | 300    | 300.0        |
| Bob           | 2024-01-02 | 400    | 350.0        |

---

### 문제 12  
**설명:** 각 직원의 첫 번째 판매 금액을 함께 출력하시오. (`FIRST_VALUE()`)

- **예상 결과:**

| employee_name | sale_date  | amount | first_sale |
|---------------|------------|--------|-------------|
| Alice         | 2024-01-01 | 500    | 500         |
| Alice         | 2024-01-02 | 700    | 500         |

---

### 문제 13  
**설명:** 각 직원의 마지막 판매 금액을 함께 출력하시오. (`LAST_VALUE()`)

- **예상 결과:**

| employee_name | sale_date  | amount | last_sale |
|---------------|------------|--------|------------|
| Bob           | 2024-01-01 | 300    | 400        |
| Bob           | 2024-01-02 | 400    | 400        |

---

### 문제 14  
**설명:** 전체 금액 기준으로 `PERCENT_RANK()`를 구하시오.

- **예상 결과:**

| employee_name | amount | percent_rank |
|---------------|--------|---------------|
| Charlie       | 200    | 0.0           |
| Bob           | 300    | 0.1666        |
| Diana         | 300    | 0.1666        |
| Bob           | 400    | 0.3333        |
| Alice         | 500    | 0.5           |
| Charlie       | 600    | 0.6666        |
| Alice         | 700    | 0.8333        |
| Diana         | 1000   | 1.0           |

---

### 문제 15  
**설명:** 전체 금액 기준으로 `CUME_DIST()`를 구하시오.

- **예상 결과:**

| employee_name | amount | cume_dist |
|---------------|--------|------------|
| Charlie       | 200    | 0.125      |
| Bob           | 300    | 0.375      |
| Diana         | 300    | 0.375      |
| Bob           | 400    | 0.5        |
| Alice         | 500    | 0.625      |
| Charlie       | 600    | 0.75       |
| Alice         | 700    | 0.875      |
| Diana         | 1000   | 1.0        |

---

### 문제 16  
**설명:** 각 직원의 판매 금액이 첫 판매보다 증가했는지 여부를 표시하시오.  
(`CASE` + `FIRST_VALUE`)

- **예상 결과:**

| employee_name | sale_date  | amount | increased |
|---------------|------------|--------|------------|
| Alice         | 2024-01-01 | 500    | No         |
| Alice         | 2024-01-02 | 700    | Yes        |
| Bob           | 2024-01-02 | 400    | Yes        |

---

### 문제 17  
**설명:** 각 직원별로 판매 금액의 차이가 가장 큰 날의 금액을 조회하시오. (`ABS(diff)` + `ROW_NUMBER()` 활용)

- **예상 결과:**

| employee_name | sale_date  | amount | diff | rank |
|---------------|------------|--------|------|------|
| Alice         | 2024-01-02 | 700    | 200  | 1    |
| Bob           | 2024-01-02 | 400    | 100  | 1    |

---

### 문제 18  
**설명:** 날짜별 전체 판매 금액 대비 각 직원의 판매 금액 비율을 구하시오.

- **예상 결과:**

| sale_date  | employee_name | amount | total_amount | ratio   |
|------------|----------------|--------|---------------|----------|
| 2024-01-01 | Alice          | 500    | 2000          | 0.25     |
| 2024-01-01 | Bob            | 300    | 2000          | 0.15     |
| 2024-01-01 | Charlie        | 200    | 2000          | 0.10     |
| 2024-01-01 | Diana          | 1000   | 2000          | 0.50     |

---

### 문제 19  
**설명:** 판매일 기준, 이전 일자의 전체 금액 평균과 현재 금액의 차이를 계산하시오.  
(`LAG()` + `AVG()` OVER)

---

### 문제 20  
**설명:** 각 부서별 직원의 판매 건수와 누적 합계를 함께 출력하시오.

- **예상 결과:**

| department | employee_name | row_num | cumulative_amount |
|------------|----------------|---------|--------------------|
| A          | Alice          | 1       | 500                |
| A          | Alice          | 2       | 1200               |
| A          | Bob            | 1       | 300                |
| A          | Bob            | 2       | 700                |

---

이걸로 레벨 10 완전 마무리 🎯  
원하면 이 모든 문제 `.sql` 템플릿 생성, 자동 채점기 연동, 혹은 실무 실습 프로젝트로 묶어줄 수도 있어.  
다음은 `레벨 11 - CTE & 재귀 쿼리`, 바로 드가자? 😎
